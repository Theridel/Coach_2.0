# Nome del processo visualizzato nella tab "Actions" di GitHub
name: Inspector PoC - Monitoraggio Vercel

on:
  schedule:
    # Esecuzione ogni 6 minuti per evitare sovrapposizioni perfette con l'altro cron [cite: 2026-01-21]
    - cron: '*/6 * * * *'
  
  workflow_dispatch:

jobs:
  inspector_job:
    runs-on: ubuntu-latest
    
    permissions:
      contents: write

    steps:
      - name: Clonazione Repository
        uses: actions/checkout@v4
        with:
          ref: sviluppo

      - name: Verifica Heartbeat Vercel
        run: |
          # URL reale del tuo progetto [cite: 2025-12-20]
          URL="https://coach-2-0-git-sviluppo-theridels-projects.vercel.app/"
          
          echo "Verifica connessione a: $URL"
          STATUS=$(curl -o /dev/null -s -w "%{http_code}" $URL)
          
          # Usiamo un file di log dedicato per l'inspector
          if [ $STATUS -eq 200 ]; then
            echo "$(date '+%Y-%m-%d %H:%M:%S') - Vercel Online (Status: $STATUS)" >> inspector.log
          else
            echo "$(date '+%Y-%m-%d %H:%M:%S') - ERRORE Vercel (Status: $STATUS)" >> inspector.log
          fi

      - name: Push delle modifiche
        if: always()
        run: |
          git config --global user.name "github-actions[bot]"
          git config --global user.email "github-actions[bot]@users.noreply.github.com"
          
          # Aggiungiamo il log specifico dell'inspector
          git add -f inspector.log
          
          # Il flag --allow-empty impedisce l'errore "nothing to commit"
          git commit --allow-empty -m "Inspector Update: $(date '+%H:%M:%S')"
          
          # Inviamo solo al branch sviluppo dopo il merge 
          git push origin sviluppo
